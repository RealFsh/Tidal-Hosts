import requests
import json


def get_lowest_delay_ip(domain):
    response = requests.get(
        f"https://tool.chinaz.com/dns/?host={domain}"
    )
    data = json.loads(response.text)
    ips = data["data"]["ips"]
    return ips[0]["ip"]


def update_hosts(hosts_file, domains):
    with open(hosts_file, "r") as f:
        lines = f.readlines()

    for domain in domains:
        line = f"{get_lowest_delay_ip(domain)} {domain}\n"
        lines.append(line)

    with open(hosts_file, "w") as f:
        f.writelines(lines)


if __name__ == "__main__":
    domains = ["sp-ad-cf.audio.tidal.com"， "ab-pr-cf.audio.tidal.com"， "vb-ad-cf.video.tidal.com"， "im-cf.manifest.tidal.com", "sp-pr-fa.audio.tidal.com", "ab-pr-fa.audio.tidal.com", "vb-ad-fa.video.tidal.com", "im-fa.manifest.tidal.com", "download.tidal.com", "desktop.tidal.com", "images.tidal.com", "login.tidal.com", "resources.tidal.com", "offer.tidal.com"]
    hosts_file = "hosts"
    update_hosts(hosts_file, domains)
